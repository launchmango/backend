<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href='http://fonts.googleapis.com/css?family=Roboto:400,900,300,600' rel='stylesheet' type='text/css'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Yo we need a title</title>

  <link rel="stylesheet" href="/static/reset.css" type="text/css" />
  <link rel="stylesheet" href="/static/style.css" type="text/css" />

</head>
<body>



    <div class="sidebar">
        <h2>Your Repos</h2><div class="add-files"><a class="plus" href="">+</a><ul class="add-menu">
            <li ><a href="">Add Repository</a></li>
             <li ><a href="">Clone Repository</a></li>
             </ul></div>

        

         <ul id="projects">
            <li><a href="">freya-on-a-mac</a></li>
            
            <li >hackerchat
                <ul>
                <li><a href="">filename.eorj</a></li>
                <li><a href="">filename.name</a></li>
                <li>noidea.js
                    <ul>
                    <li><a href="">filename.eorj</a></li>
                <li><a href="">filename.name</a></li>
                <li><a href="">noidea.js</a></li>
               </ul></li>
            </ul></li>
                <li><a href="">PennAppsApps</a></li>
            </ul>

       <a href=""> <div class="log-out"><h2>Log out</h2></div></a>
    </div>

<pre id="editor">int main () {
    int x = 0;
    do {
        x++; 
        printf("Count is: %i\n", x);
    } while(x < 10);
 
    return 0;



}</pre>

<div class="bottombar">
       <div class="logo">
            <img src="">
        </div>

        <div class="update">
            <p>Saved at 11:34</p>
        </div>

        <a href=""><div class="run-button" id="run-button">
            <p>Run<img src="http://www.radiobilly.com/wp-content/themes/radiobilly/img/play-white.png"></p>
           
        </div></a>
         <a href=""><div class="commit-button">
            <p>Commit</p>
           
        </div></a>
    </div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<!-- load list code-->
<script type="text/javascript" src="static/listCollapse.js"></script>


<!-- load ace -->
<script src="/static/ace/ace.js"></script>
<!-- load ace themelist extension -->
<script src="/static/ace/ext-themelist.js"></script>
<script>

var dom = require("ace/lib/dom");

//add command to all new editor instaces
require("ace/commands/default_commands").commands.push({
    name: "Toggle Fullscreen",
    bindKey: "F11",
    exec: function(editor) {
        var fullScreen = dom.toggleCssClass(document.body, "fullScreen")
        dom.setCssClass(editor.container, "fullScreen", fullScreen)
        editor.setAutoScrollEditorIntoView(!fullScreen)
        editor.resize()
    }
})

// create first editor
var editor = ace.edit("editor");
editor.setTheme("ace/theme/twilight");
editor.session.setMode("ace/mode/objectivec");
editor.renderer.setScrollMargin(10, 10);
editor.setOptions({
    // "scrollPastEnd": 0.8,
    autoScrollEditorIntoView: true
});

var count = 1;
function add() {
    var oldEl = editor.container
    var pad = document.createElement("div")
    pad.style.padding = "40px"
    oldEl.parentNode.insertBefore(pad, oldEl.nextSibling)

    var el = document.createElement("div")
    oldEl.parentNode.insertBefore(el, pad.nextSibling)

    count++
    var theme = themes[Math.floor(themes.length * Math.random() - 1e-5)]
    editor = ace.edit(el)
    editor.setOptions({
        mode: "ace/mode/javascript",
        theme: theme,
        autoScrollEditorIntoView: true
    })

    editor.setValue([
        "this is editor number: ", count, "\n",
        "using theme \"", theme, "\"\n",
        ":)"
    ].join(""), -1)

    scroll()
}

var themes = require("ace/ext/themelist").themes.map(function(t){return t.theme});

window.add = add;
window.scroll = scroll;

// lol state machine
currentRepo = null;

function listRepositories() {
  $.ajax({
    type: "GET",
    url: '/repositories',
    success: function (repositoriesJSON) {
      repositories = JSON.parse(repositoriesJSON);
      console.log(repositories);
    },
    error: function (jqXHR, textStatus, errorThrown) {
      console.log(textStatus);
      alert(textStatus);
    }
  });
};

function buildRepository(id, callback) {
  $.ajax({
    type: "POST",
    url: '/repositories/' + id + '/build',
    success: function (response) {
      callback(null, response);
    },
    error: function (jqXHR, textStatus) {
      callback(textStatus);
    }
  });
};

function runRepository(id, callback) {
  $.ajax({
    type: "GET",
    url: '/repositories/' + id + '/run',
    success: function (response) {
      callback(null, response);
    },
    error: function (jqXHR, textStatus) {
      callback(textStatus);
    }
  });
};

function deleteRepository(id, callback) {
  $.ajax({
    type: 'DELETE',
    url: '/repositories/' + id,
    error: function (jqXHR, textStatus) {
      callback(textStatus);
    },
    success: function (response) {
      callback(null);
    }
  });
};

function addRepository(url, callback) {
  $.ajax({
    type: "POST",
    url: '/repositories',
    data: JSON.stringify({url: url}),
    error: function (jqXHR, textStatus) {
      callback(textStatus);
    },
    success: function (response) {
      callback(null, response);
      currentRepo = response.id;
    },
    dataType: 'json'
  });
};


$('#run-button').on('click', function (event) {
  var button = $(event.target).children('p').first();
  console.log(button);
  button.text("building...");
  buildRepository(currentRepo, function (err) {
    if (err) {
      button.text("build failed");
    } else {
      
    }
  });
  runRepository(currentRepo, function (err) {
    if (err) {
      button.text("failed");
    } else {
      button.text("running");
    }
  });
  return false;
});


window.onload = function () {

  //choose one of these options
  //option 2 - auto-child-collapse

  compactMenu('projects', true, '&#128194');
}
</script>
</body>
</html>
